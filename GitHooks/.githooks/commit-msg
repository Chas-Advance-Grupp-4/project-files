#!/bin/bash

COMMIT_MSG_FILE=$1
COMMIT_MSG=$(cat "$COMMIT_MSG_FILE")

PATTERN="^(feat|fix|docs|style|refactor|test|chore)(\([a-z0-9_-]+\))?: .+"

if ! echo "$COMMIT_MSG" | grep -qE "$PATTERN"; then
  echo "Commit message does not follow the Conventional Commits format."
  echo ""
  echo "Expected format: type(optional-scope): description"
  echo ""
  echo "Allowed types:"
  echo "  feat      A new feature"
  echo "  fix       A bug fix"
  echo "  docs      Documentation only changes"
  echo "  style     Formatting changes (no code logic)"
  echo "  refactor  Code changes that are not fixes or features"
  echo "  test      Adding or updating tests"
  echo "  chore     Maintenance tasks (build, CI, dependencies)"
  echo ""
  echo "Examples:"
  echo "  feat: add login endpoint"
  echo "  fix(auth): handle expired JWT"
  echo "  docs(readme): update setup instructions"
  echo ""
  echo "Your commit message was:"
  echo "  \"$COMMIT_MSG\""
  echo ""
  echo "To fix this, run:"
  echo "  git commit --amend"
  echo "and edit the commit message to match the format above."
  exit 1
fi
